# tgBot
Телеграм бот позволяет парсить продукты по скидке с сайта магнита. Сначала бот запрашивает имя и возраст (возраст должен задаваться числом, иначе бот попросит ввести его еще раз), после чего бот запрашивает город, в котором требуется искать скидки после вводится количество продуктов (тоже должно задаваться числом). Далее в течение некоторого времени бот собирает данные и отправляет их пользователю в виде Ex таблички. Если пользователь указал возраст меньше 18, то среди товаров в табличке не будет алкогольной продукции.

Сам бот написан с помощью библиотеки aiogram. Часть с парсингом использует библиотеки bs4 и selenium. Я долгое время пытался обойтись без selenium, но вкладка акций магнита представлена в виде динамической ленты, которая дополняется в процессе скроллинга, причем номер страницы на которой я нахожусь, никак не отображается в url адресе, и даже в реквестах во вкладке network мне не удалось получить данные о товарах со следующих страниц. Так что сайт открывается с помощь selenium, далее прокручивается нужное количество страниц, чтобы подгрузить требуемое количество товаров, а уже только поле этого программа обращается к html коду страницы. Таким образом запрос обрабатывается не слишком быстро.

Есть еще моментик: если слишком часто отправлять большие запросы, то магнит может заблокировать для сети, с которой вы включаете бота доступ к их сайту. Лечится это перезапуском роутера. (Да, это из-за меня теперь нельзя зайти на сайт магнита с сети mipt-ng)

Еще может возникнуть проблема с кодировкой в создаваемом csv файле. Я пользуюсь виндоус, в связи с чем поставил кодировку utf-16 (везде писали что нужно ставить cp1251, но у меня с ней почему то не работает, возможно я идиот и что-то неправильно понял) и разделитель “\t”, теперь у меня файл открывается нормально, но если нужно открывать бота с яблочек, то кодировка и разделитель должны стоять по умолчанию (utf8, “,”).

Также магнит меня порадовал и в день отправки проекта добавил на сайт всплывающее окно их приложения, пришлось немного поправить бота. Теперь опасаюсь новых изменений на сайте, если что-то снова изменят, отправлю новую версию кода. 
Помимо библиотек для работы проекта необходима установка вебдрайвера.

